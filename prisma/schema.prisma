generator client {
  provider      = "prisma-client-js"
  output        = "../src/generated/prisma"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model lojas {
  id             Int     @id @default(autoincrement())
  nome           String? @db.VarChar(80)
  endereco       String?
  gerente        Int?
  qtd_total_prod Int?
  estoque_por_loja estoque_loja[]
  pedidos        pedidos[]
}

model produtos {
  id                    Int               @id @default(autoincrement())
  codigo                String            @unique @db.VarChar(60)
  descricao             String?
  fornecedor            String?           @db.VarChar(80)
  preco_venda           Decimal           @db.Decimal(18, 2)
  estoque_por_loja      estoque_loja[]
  itens_pedido          itens_pedido[]
}

model setor {
  id        Int     @id @default(autoincrement())
  descricao String? @db.VarChar(60)
}

model estoque_loja {
  id                     Int       @id @default(autoincrement())
  produto_id             Int
  loja_id                Int
  quantidade_estoque     Int       @default(0)
  quantidade_mostruario  Int       @default(0)
  quantidade_disponivel  Int       @default(0)

  produto                produtos  @relation(fields: [produto_id], references: [id])
  loja_ref               lojas     @relation(fields: [loja_id], references: [id])

  @@unique([produto_id, loja_id])
}

model usuarios {
  id              Int      @id @default(autoincrement())
  nome            String?  @db.VarChar(50)
  login           String?  @db.VarChar(40)
  senha           Int?
  setor           Int?
  loja            Int?
  inativo         Boolean? @default(false)
  email           String?
  id_vendedor_tiny String? @unique @db.VarChar(50)
}

model pedidos {
  id                  Int              @id @default(autoincrement())
  codigo_tiny         String?          @unique @db.VarChar(100)
  numero              String?          @db.VarChar(50)
  data_pedido         DateTime?
  data_atualizacao    DateTime         @updatedAt
  status              String?          @db.VarChar(50)
  cliente_nome        String?          @db.VarChar(200)
  valor_total         Decimal?         @db.Decimal(18, 2)
  id_vendedor         String?          @db.VarChar(50)
  nome_vendedor       String?          @db.VarChar(200)
  situacao            String?          @db.VarChar(100)
  loja_id             Int?
  sincronizado_em     DateTime?
  estoque_baixado     Boolean          @default(false)
  estoque_baixado_em  DateTime?
  itens               itens_pedido[]
  loja_ref            lojas?           @relation(fields: [loja_id], references: [id])
  
  @@index([codigo_tiny])
  @@index([status])
  @@index([data_pedido])
  @@index([situacao])
  @@index([estoque_baixado])
}

model itens_pedido {
  id                  Int              @id @default(autoincrement())
  pedido_id           Int
  produto_id           Int?
  codigo_produto_tiny  String?         @db.VarChar(100)
  descricao           String?          @db.VarChar(500)
  quantidade          Decimal          @db.Decimal(18, 2)
  valor_unitario      Decimal          @db.Decimal(18, 2)
  valor_total          Decimal          @db.Decimal(18, 2)
  pedido              pedidos          @relation(fields: [pedido_id], references: [id], onDelete: Cascade)
  produto             produtos?        @relation(fields: [produto_id], references: [id])
  
  @@index([pedido_id])
  @@index([produto_id])
  @@index([codigo_produto_tiny])
}
